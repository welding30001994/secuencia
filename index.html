<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feddaddy Company - Registro de Trading</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://raw.githubusercontent.com/welding30001994/oxxomax_1/refs/heads/main/leon_con_llamas_y_el_nombre_de.jpeg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            border: 1px solid #00eeff;
            box-shadow: 0 0 15px rgba(0, 238, 255, 0.5);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #00eeff;
            text-shadow: 0 0 10px rgba(0, 238, 255, 0.8);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #ccc;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .form-section, .data-section {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #00eeff;
            box-shadow: 0 0 15px rgba(0, 238, 255, 0.3);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00eeff;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00eeff;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #00eeff;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            font-size: 1rem;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 238, 255, 0.5);
        }

        .camera-container {
            margin-bottom: 20px;
            text-align: center;
        }

        #cameraPreview {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px dashed #00eeff;
            border-radius: 8px;
            margin-bottom: 10px;
            object-fit: cover;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #00eeff;
            color: #000;
        }

        .btn-primary:hover {
            background: #00c4d4;
            box-shadow: 0 0 15px rgba(0, 238, 255, 0.8);
        }

        .btn-secondary {
            background: #ff00aa;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #d4008c;
            box-shadow: 0 0 15px rgba(255, 0, 170, 0.8);
        }

        .operations-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .operation-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00eeff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .operation-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .operation-type {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .buy {
            background: rgba(0, 255, 0, 0.2);
            color: #0f0;
        }

        .sell {
            background: rgba(255, 0, 0, 0.2);
            color: #f00;
        }

        .operation-image {
            width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #ccc;
            font-size: 0.9rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border: 1px solid #00eeff;
            box-shadow: 0 0 15px rgba(0, 238, 255, 0.5);
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FEDDADDY COMPANY</h1>
            <p class="subtitle">Sistema de registro de operaciones de trading - Visión futurista</p>
        </header>

        <div class="app-container">
            <div class="form-section">
                <h2 class="section-title">Registrar Nueva Operación</h2>
                <form id="tradingForm">
                    <div class="form-group">
                        <label for="asset">Activo/Par</label>
                        <input type="text" id="asset" required placeholder="Ej: BTC/USD, EUR/USD">
                    </div>

                    <div class="form-group">
                        <label for="operationType">Tipo de Operación</label>
                        <select id="operationType" required>
                            <option value="">Seleccione...</option>
                            <option value="buy">BUY</option>
                            <option value="sell">SELL</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="entryPrice">Precio de Entrada</label>
                        <input type="number" id="entryPrice" step="0.00001" required placeholder="0.00000">
                    </div>

                    <div class="form-group">
                        <label for="stopLoss">Stop Loss</label>
                        <input type="number" id="stopLoss" step="0.00001" required placeholder="0.00000">
                    </div>

                    <div class="form-group">
                        <label for="takeProfit">Take Profit</label>
                        <input type="number" id="takeProfit" step="0.00001" required placeholder="0.00000">
                    </div>

                    <div class="form-group">
                        <label for="notes">Notas Adicionales</label>
                        <textarea id="notes" rows="3" placeholder="Observaciones sobre la operación..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Captura de Pantalla</label>
                        <div class="camera-container">
                            <video id="cameraPreview" autoplay></video>
                            <button type="button" class="btn btn-secondary" id="takePhotoBtn">Tomar Foto</button>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-secondary" id="uploadPhotoBtn">Subir Imagen</button>
                        </div>
                        <canvas id="photoCanvas" style="display: none;"></canvas>
                    </div>

                    <button type="submit" class="btn btn-primary">Guardar Operación</button>
                </form>
            </div>

            <div class="data-section">
                <h2 class="section-title">Operaciones Registradas</h2>
                <div class="operations-list" id="operationsList">
                    <!-- Las operaciones se cargarán aquí dinámicamente -->
                    <p style="text-align: center; padding: 20px;">Cargando operaciones...</p>
                </div>
            </div>
        </div>

        <footer>
            <p>FEDDADDY COMPANY © 2023 - Sistema de Registro de Trading</p>
            <p>Todos los datos están protegidos y solo accesibles para usuarios registrados</p>
        </footer>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD3MI1klgBSHs1h6QT4VPNoScCfCwMV_Ck",
            authDomain: "usuario-b0384.firebaseapp.com",
            databaseURL: "https://usuario-b0384-default-rtdb.firebaseio.com",
            projectId: "usuario-b0384",
            storageBucket: "usuario-b0384.firebasestorage.app",
            messagingSenderId: "196266170863",
            appId: "1:196266170863:web:4ea57f489df94aba94fe1a"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Variables globales
        let cameraStream = null;
        let capturedPhotoData = null;

        // Elementos DOM
        const cameraPreview = document.getElementById('cameraPreview');
        const takePhotoBtn = document.getElementById('takePhotoBtn');
        const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
        const imageUpload = document.getElementById('imageUpload');
        const photoCanvas = document.getElementById('photoCanvas');
        const tradingForm = document.getElementById('tradingForm');
        const operationsList = document.getElementById('operationsList');
        const notification = document.getElementById('notification');

        // Inicializar la cámara
        async function initCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                cameraPreview.srcObject = cameraStream;
            } catch (error) {
                console.error("Error al acceder a la cámara:", error);
                showNotification("No se pudo acceder a la cámara. Use la opción para subir imagen.", "error");
            }
        }

        // Tomar foto
        takePhotoBtn.addEventListener('click', () => {
            const context = photoCanvas.getContext('2d');
            photoCanvas.width = cameraPreview.videoWidth;
            photoCanvas.height = cameraPreview.videoHeight;
            context.drawImage(cameraPreview, 0, 0, photoCanvas.width, photoCanvas.height);
            
            capturedPhotoData = photoCanvas.toDataURL('image/png');
            showNotification("Foto tomada correctamente. Guarde la operación.", "success");
        });

        // Subir imagen
        uploadPhotoBtn.addEventListener('click', () => {
            imageUpload.click();
        });

        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    capturedPhotoData = e.target.result;
                    showNotification("Imagen cargada correctamente. Guarde la operación.", "success");
                };
                reader.readAsDataURL(file);
            }
        });

        // Guardar operación
        tradingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!capturedPhotoData) {
                showNotification("Debe tomar o subir una imagen primero", "error");
                return;
            }
            
            const operation = {
                asset: document.getElementById('asset').value,
                type: document.getElementById('operationType').value,
                entryPrice: parseFloat(document.getElementById('entryPrice').value),
                stopLoss: parseFloat(document.getElementById('stopLoss').value),
                takeProfit: parseFloat(document.getElementById('takeProfit').value),
                notes: document.getElementById('notes').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                // Subir imagen a Firebase Storage
                const imageRef = storage.ref().child(`trading_images/${Date.now()}.png`);
                const response = await fetch(capturedPhotoData);
                const blob = await response.blob();
                const snapshot = await imageRef.put(blob);
                const imageUrl = await snapshot.ref.getDownloadURL();
                
                // Guardar operación en Firestore
                operation.imageUrl = imageUrl;
                await db.collection('operations').add(operation);
                
                showNotification("Operación guardada correctamente", "success");
                tradingForm.reset();
                capturedPhotoData = null;
                loadOperations();
            } catch (error) {
                console.error("Error al guardar:", error);
                showNotification("Error al guardar la operación", "error");
            }
        });

        // Cargar operaciones
        async function loadOperations() {
            try {
                const snapshot = await db.collection('operations')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                operationsList.innerHTML = '';
                
                if (snapshot.empty) {
                    operationsList.innerHTML = '<p style="text-align: center; padding: 20px;">No hay operaciones registradas</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const operation = doc.data();
                    const operationElement = document.createElement('div');
                    operationElement.classList.add('operation-card');
                    
                    operationElement.innerHTML = `
                        <div class="operation-header">
                            <strong>${operation.asset}</strong>
                            <span class="operation-type ${operation.type}">${operation.type.toUpperCase()}</span>
                        </div>
                        <div><strong>Entrada:</strong> ${operation.entryPrice}</div>
                        <div><strong>Stop Loss:</strong> ${operation.stopLoss}</div>
                        <div><strong>Take Profit:</strong> ${operation.takeProfit}</div>
                        ${operation.notes ? `<div><strong>Notas:</strong> ${operation.notes}</div>` : ''}
                        <img src="${operation.imageUrl}" alt="Captura" class="operation-image">
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="downloadOperation('${doc.id}')">Descargar</button>
                            <button class="btn btn-secondary btn-small" onclick="shareOperation('${doc.id}')">Compartir</button>
                        </div>
                    `;
                    
                    operationsList.appendChild(operationElement);
                });
            } catch (error) {
                console.error("Error al cargar operaciones:", error);
                operationsList.innerHTML = '<p style="text-align: center; padding: 20px;">Error al cargar las operaciones</p>';
            }
        }

        // Descargar operación
        async function downloadOperation(operationId) {
            try {
                const doc = await db.collection('operations').doc(operationId).get();
                if (!doc.exists) {
                    showNotification("Operación no encontrada", "error");
                    return;
                }
                
                const operation = doc.data();
                const text = `
                    FEDDADDY COMPANY - Registro de Trading
                    -------------------------------------
                    Activo: ${operation.asset}
                    Operación: ${operation.type.toUpperCase()}
                    Precio de Entrada: ${operation.entryPrice}
                    Stop Loss: ${operation.stopLoss}
                    Take Profit: ${operation.takeProfit}
                    Notas: ${operation.notes || 'Ninguna'}
                    Fecha: ${new Date(operation.timestamp?.toDate()).toLocaleString()}
                `;
                
                const element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
                element.setAttribute('download', `operacion_${operation.asset}_${new Date().getTime()}.txt`);
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
                
                showNotification("Operación descargada", "success");
            } catch (error) {
                console.error("Error al descargar:", error);
                showNotification("Error al descargar la operación", "error");
            }
        }

        // Compartir operación
        async function shareOperation(operationId) {
            try {
                const doc = await db.collection('operations').doc(operationId).get();
                if (!doc.exists) {
                    showNotification("Operación no encontrada", "error");
                    return;
                }
                
                const operation = doc.data();
                const text = `Mira mi operación de trading en ${operation.asset} - Registrada en FEDDADDY COMPANY`;
                
                if (navigator.share) {
                    await navigator.share({
                        title: 'Operación de Trading - FEDDADDY COMPANY',
                        text: text,
                        url: window.location.href
                    });
                } else {
                    await navigator.clipboard.writeText(text);
                    showNotification("Enlace copiado al portapapeles", "success");
                }
            } catch (error) {
                console.error("Error al compartir:", error);
                showNotification("Error al compartir la operación", "error");
            }
        }

        // Mostrar notificación
        function showNotification(message, type = "info") {
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === "error") {
                notification.style.borderColor = "#ff00aa";
            } else if (type === "success") {
                notification.style.borderColor = "#00ff00";
            } else {
                notification.style.borderColor = "#00eeff";
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Inicializar la aplicación
        window.addEventListener('load', () => {
            initCamera();
            loadOperations();
        });
    </script>
</body>
</html>
